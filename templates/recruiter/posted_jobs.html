<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Posted Jobs - JOBSEEK</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
      crossorigin="anonymous"
    />
    <script
      src="https://kit.fontawesome.com/0e035b9984.js"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='webpage/css/main.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <style>
      body {
        background-color: #f8f9fa;
        min-height: 100vh;
        /* display: flex; */
        flex-direction: column;
      }

      .navbar .container {
        display: flex;
        justify-content: flex-start;
        align-items: center;
      }

      .navbar-brand {
        margin-right: 3rem;
      }

      .navbar-nav {
        display: flex;
        gap: 2rem;
      }

      .navbar-nav:last-child {
        margin-left: auto;
      }

      .main {
        background-color: #f8f9fa;
        padding: 2rem 0;
        flex: 1;
        margin: 0;
      }

      .page-header {
        margin-bottom: 2.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .page-title {
        color: #2c3e50;
        font-size: 1.75rem;
        font-weight: 600;
        margin: 0;
      }

      .header-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
      }

      .search-wrapper {
        position: relative;
        width: 300px;
      }

      .search-wrapper i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
      }

      #job-search-input {
        width: 100%;
        padding: 0.75rem 1rem 0.75rem 2.5rem;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.95rem;
        background-color: white;
        transition: all 0.2s ease;
      }

      #job-search-input:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        outline: none;
      }

      .post-job-btn {
        background-color: #2563eb;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        text-decoration: none;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 500;
      }

      .post-job-btn:hover {
        background-color: #1d4ed8;
        color: white;
        transform: translateY(-2px);
      }

      .jobs-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .job-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        border: 1px solid #e5e7eb;
      }

      .job-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .job-card h4 {
        color: #1f2937;
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1rem;
      }

      .job-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
        font-size: 0.9rem;
      }

      .job-meta span {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #6b7280;
      }

      .job-meta .fas.fa-building {
        color: #2563eb;
      }

      .job-meta .fas.fa-map-marker-alt {
        color: #dc2626;
      }

      .job-meta .fas.fa-clock {
        color: #059669;
      }

      .job-details {
        margin-bottom: 1.5rem;
        font-size: 0.95rem;
        color: #4b5563;
      }

      .job-actions {
        display: flex;
        gap: 1rem;
      }

      .job-actions a {
        flex: 1;
        text-align: center;
        padding: 0.75rem;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.9rem;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .view-btn {
        background-color: #3b82f6;
        color: white;
      }

      .view-btn:hover {
        background-color: #2563eb;
        color: white;
      }

      .edit-btn {
        background-color: #10b981;
        color: white;
      }

      .edit-btn:hover {
        background-color: #059669;
        color: white;
      }

      .empty-state {
        text-align: center;
        padding: 2rem;
        background: white;
        border-radius: 12px;
        margin-bottom: 2rem;
      }

      .empty-state p {
        color: #6b7280;
        margin-bottom: 1rem;
      }

      @media (max-width: 768px) {
        .search-wrapper {
          width: 100%;
        }

        .post-job-btn {
          width: 100%;
          justify-content: center;
        }

        .jobs-grid {
          grid-template-columns: 1fr;
        }
      }

      footer {
        border-top: 1px solid #e9ecef;
        background-color: #f8f9fa;
        padding: 20px 0;
        margin-top: 0;
      }

      footer p {
        margin: 0;
        color: #6c757d;
      }
    </style>
  </head>

  <body>
    {% include 'recruiter/_navbar.html' %}

    <main>
      <div class="main">
        <div class="container">
          <div class="page-header">
            <h2 class="page-title">Your Posted Jobs</h2>
            <div class="header-actions">
              <div class="search-wrapper">
                <i class="fas fa-search"></i>
                <input
                  type="text"
                  id="job-search-input"
                  placeholder="Search jobs..."
                />
              </div>
              <a
                href="{{ url_for('recruiter.post_job') }}"
                class="post-job-btn"
              >
                <i class="fas fa-plus"></i>
                Post a New Job
              </a>
            </div>
          </div>

          <div id="search-results" style="display: none">
            <div id="results-container" class="jobs-grid">
              <!-- Search results will be dynamically inserted here -->
            </div>
          </div>

          {% if jobs %}
          <div class="jobs-grid" id="main-jobs-grid">
            {% for job in jobs %}
            <div class="job-card">
              <h4>{{ job.title }}</h4>
              <div class="job-meta">
                <span><i class="fas fa-building"></i> {{ company_name }}</span>
                <span
                  ><i class="fas fa-map-marker-alt"></i> {{ job.location
                  }}</span
                >
                <span><i class="fas fa-clock"></i> {{ job.job_type }}</span>
              </div>
              <div class="job-details">
                <p>
                  <strong>Salary:</strong> {{ job.salary_min }} - {{
                  job.salary_max }} LPA<br />
                  <strong>Experience:</strong> {{ job.experience_level }}<br />
                  <strong>Posted:</strong> {{
                  job.created_at.strftime('%Y-%m-%d') }}
                </p>
              </div>
              <div class="job-actions">
                <a
                  href="{{ url_for('recruiter.view_applications', job_id=job._id) }}"
                  class="view-btn"
                >
                  <i class="fas fa-users"></i> View Applications
                </a>
                <a
                  href="{{ url_for('recruiter.edit_job', job_id=job._id) }}"
                  class="edit-btn"
                >
                  <i class="fas fa-edit"></i> Edit
                </a>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="empty-state">
            <p>You haven't posted any jobs yet.</p>
            <a href="{{ url_for('recruiter.post_job') }}" class="post-job-btn">
              <i class="fas fa-plus-circle me-2"></i>Post Your First Job
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </main>

    <footer>
      <div class="container text-center">
        <p>&copy; 2024 JOBSEEK</p>
      </div>
    </footer>

    <div class="fb2022-copy">Fbee 2022 copyright</div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
      $(document).ready(function () {
        var searchTimeout;
        var $mainJobsGrid = $("#main-jobs-grid");
        var $searchResults = $("#search-results");

        $("#job-search-input").on("keyup", function () {
          clearTimeout(searchTimeout);
          var searchTerm = $(this).val().trim();

          if (searchTerm.length === 0) {
            $searchResults.hide();
            $mainJobsGrid.show();
            return;
          }

          searchTimeout = setTimeout(function () {
            $.ajax({
              url: "{{ url_for('recruiter.search_jobs') }}",
              method: "GET",
              data: { query: searchTerm },
              success: function (response) {
                var resultsHtml = "";
                if (response.length > 0) {
                  response.forEach(function (job) {
                    resultsHtml += `
                      <div class="job-card">
                        <h4>${job.title}</h4>
                        <div class="job-meta">
                          <span><i class="fas fa-building"></i> {{ company_name }}</span>
                          <span><i class="fas fa-map-marker-alt"></i> ${
                            job.location
                          }</span>
                          <span><i class="fas fa-clock"></i> ${
                            job.job_type
                          }</span>
                        </div>
                        <div class="job-details">
                          <p>
                            <strong>Salary:</strong> ${parseFloat(
                              job.salary_min
                            ).toFixed(1)} - ${parseFloat(
                      job.salary_max
                    ).toFixed(1)} LPA<br>
                            <strong>Experience:</strong> ${
                              job.experience_level
                            }<br>
                            <strong>Posted:</strong> ${job.created_at}
                          </p>
                        </div>
                        <div class="job-actions">
                          <a href="{{ url_for('recruiter.view_applications', job_id='') }}${
                            job.id
                          }" class="view-btn">
                            <i class="fas fa-users"></i> View Applications
                          </a>
                          <a href="{{ url_for('recruiter.edit_job', job_id='') }}${
                            job.id
                          }" class="edit-btn">
                            <i class="fas fa-edit"></i> Edit
                          </a>
                        </div>
                      </div>
                    `;
                  });
                  $mainJobsGrid.hide();
                  $searchResults.show();
                } else {
                  resultsHtml =
                    "<p class='text-center text-muted mt-4'>No results found.</p>";
                }
                $("#results-container").html(resultsHtml);
              },
              error: function (jqXHR, textStatus, errorThrown) {
                console.error(
                  "AJAX error: " + textStatus + " : " + errorThrown
                );
                $("#results-container").html(
                  "<p class='text-center text-danger mt-4'>Error occurred while searching. Please try again later.</p>"
                );
              },
            });
          }, 300);
        });
      });
    </script>
  </body>
</html>
